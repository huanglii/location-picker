var ee=Object.defineProperty;var te=(s,n,o)=>n in s?ee(s,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[n]=o;var y=(s,n,o)=>(te(s,typeof n!="symbol"?n+"":n,o),o);import{c as oe,r as h,m as L,a as se,b as R,j as i,d as re,e as w,f as ne,C as $,g as H,T as j,u as _,h as D,S as z,R as C,I as A,L as F,i as ae,W as ie}from"./vendor-55d724e4.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&t(l)}).observe(document,{childList:!0,subtree:!0});function o(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(e){if(e.ep)return;e.ep=!0;const r=o(e);fetch(e.href,r)}})();const J=oe()((s,n)=>({map:void 0,setMap:o=>s({map:o}),removeMap:()=>{s({map:void 0})},addGroupLayer(o,t){const e=n().map;e&&e.addGroupLayer(o,t)},removeGroupLayer(o,t){const e=n().map;e&&e.removeGroupLayer(o,t)},removeGroupLayers(){const o=n().map;o&&o.removeGroupLayers()},getSource(o){const t=n().map;if(t)return t.getSource(o)},addSource(o,t){const e=n().map;e&&e.addSource(o,t)},removeSource(o){const t=n().map;t&&t.removeSource(o)},getLayer(o){const t=n().map;if(t)return t.getLayer(o)},addLayer(o,t){const e=n().map;e&&e.addLayer(o,t)},removeLayer(o){const t=n().map;t&&t.removeLayer(o)},setBasemapStyle(o,t,e){const r=n().map;r&&r.setBasemapStyle(o,t,e)},clear:o=>{const t=n().map;if(t&&t.getStyle())if(Array.isArray(o))for(let e=0,r=o.length;e<r;e++){const l=o[e];t.removeGroupLayer(l),t.getLayer(l)&&t.removeLayer(l),t.getSource(l)&&t.removeSource(l)}else{if(o.groupLayerIds)for(let e=0,r=o.groupLayerIds.length;e<r;e++)t.removeGroupLayer(o.groupLayerIds[e]);if(o.layerIds)for(let e=0,r=o.layerIds.length;e<r;e++)t.removeLayer(o.layerIds[e]);if(o.sourceIds)for(let e=0,r=o.sourceIds.length;e<r;e++)t.removeSource(o.sourceIds[e])}}})),x=class x{constructor(n,o){y(this,"controlContainer");y(this,"events");y(this,"map");y(this,"mapStyleContainer");y(this,"styleButton");y(this,"styles");y(this,"defaultStyle");this.styles=n||x.DEFAULT_STYLES;const t=typeof o=="string"?o:o?o.defaultStyle:void 0;this.defaultStyle=t||x.DEFAULT_STYLE,this.onDocumentClick=this.onDocumentClick.bind(this),this.events=typeof o!="string"&&o?o.eventListeners:void 0}getDefaultPosition(){return"top-right"}onAdd(n){this.map=n,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("mapboxgl-ctrl"),this.controlContainer.classList.add("mapboxgl-ctrl-group"),this.mapStyleContainer=document.createElement("div"),this.styleButton=document.createElement("button"),this.styleButton.type="button",this.mapStyleContainer.classList.add("mapboxgl-style-list");for(const o of this.styles){const t=document.createElement("button");t.type="button",t.innerText=o.title,t.classList.add(o.title.replace(/[^a-z0-9-]/gi,"_")),t.dataset.uri=JSON.stringify(o.uri),t.addEventListener("click",e=>{const r=e.srcElement;if(this.closeModal(),r.classList.contains("active")||this.events&&this.events.onOpen&&this.events.onOpen(e))return;const l=JSON.parse(r.dataset.uri);this.map.setBasemapStyle(l);const c=this.mapStyleContainer.getElementsByClassName("active");for(;c[0];)c[0].classList.remove("active");r.classList.add("active"),this.events&&this.events.onChange&&this.events.onChange(e,l)}),o.title===this.defaultStyle&&t.classList.add("active"),this.mapStyleContainer.appendChild(t)}return this.styleButton.classList.add("mapboxgl-ctrl-icon"),this.styleButton.classList.add("mapboxgl-style-switcher"),this.styleButton.addEventListener("click",o=>{this.events&&this.events.onSelect&&this.events.onSelect(o)||this.openModal()}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.styleButton),this.controlContainer.appendChild(this.mapStyleContainer),this.controlContainer}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.styleButton||(this.styleButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.map=void 0)}closeModal(){this.mapStyleContainer&&this.styleButton&&(this.mapStyleContainer.style.display="none",this.styleButton.style.display="block")}openModal(){this.mapStyleContainer&&this.styleButton&&(this.mapStyleContainer.style.display="block",this.styleButton.style.display="none")}onDocumentClick(n){this.controlContainer&&!this.controlContainer.contains(n.target)&&this.closeModal()}};y(x,"DEFAULT_STYLE","标准"),y(x,"DEFAULT_STYLES",[{title:"标准",uri:"mapbox://styles/huanglii/clm8knsuz012801r41pbwdcku"},{title:"浅色",uri:"mapbox://styles/huanglii/clm93m2qr011a01r671y2hjjm"},{title:"深色",uri:"mapbox://styles/huanglii/clm8quldc013701nza7a35j7j"},{title:"影像",uri:"mapbox://styles/huanglii/cl0j3k0wn000n14nznby52wod"},{title:"天地图",uri:"./map-style/satellite.json"}]);let P=x;const le=s=>{const{setMap:n,removeMap:o}=J(),t=h.useRef(null),[e]=h.useState(Math.random().toString(16).substring(2));L.accessToken="pk.eyJ1IjoiaHVhbmdsaWkiLCJhIjoiY2wwM2E4a2drMDVrZjNrcGRucHIxOHo0cyJ9.0ecG5KGQE6R-SmhxvLvhHg";const l=Object.assign({},{style:"mapbox://styles/huanglii/clm8knsuz012801r41pbwdcku",container:e,bounds:[105.289838,28.164713,110.195632,32.204171],fitBoundsOptions:{padding:{top:20,right:20,bottom:20,left:20}},attributionControl:!1,locale:{"NavigationControl.ResetBearing":"指北","NavigationControl.ZoomIn":"放大","NavigationControl.ZoomOut":"缩小","GeolocateControl.FindMyLocation":"定位","GeolocateControl.LocationNotAvailable":"定位不可用"}},s.mapboxOptions);return h.useEffect(()=>{const c=new se(l);return c.addControl(new R.NavigationControl({visualizePitch:!0})),c.addControl(new R.GeolocateControl({trackUserLocation:!0,showUserHeading:!0})),c.addControl(new L.AttributionControl({customAttribution:`v${L.version}`})),c.addControl(new P),c.on("load",()=>{n(c),s.onMapLoaded&&s.onMapLoaded(c)}),c.on("remove",()=>{o()}),()=>c.remove()},[]),i.jsx("div",{id:e,className:s.className,style:{width:"100%",height:"100%"},ref:t})};var u=3.141592653589793,S=6378245,M=.006693421622965943,ce=function(e,t){var t=+t,e=+e;if(W(e,t))return[e,t];var r=K(e-105,t-35),l=Y(e-105,t-35),c=t/180*u,m=Math.sin(c);m=1-M*m*m;var v=Math.sqrt(m);r=r*180/(S*(1-M)/(m*v)*u),l=l*180/(S/v*Math.cos(c)*u);var g=t+r,E=e+l;return[E,g]};function ue(t,o){var o=+o,t=+t;if(W(t,o))return[t,o];var e=K(t-105,o-35),r=Y(t-105,o-35),l=o/180*u,c=Math.sin(l);c=1-M*c*c;var m=Math.sqrt(c);e=e*180/(S*(1-M)/(c*m)*u),r=r*180/(S/m*Math.cos(l)*u);var v=o+e,g=t+r;return[+(t*2-g).toFixed(6),+(o*2-v).toFixed(6)]}var K=function(e,t){var t=+t,e=+e,r=-100+2*e+3*t+.2*t*t+.1*e*t+.2*Math.sqrt(Math.abs(e));return r+=(20*Math.sin(6*e*u)+20*Math.sin(2*e*u))*2/3,r+=(20*Math.sin(t*u)+40*Math.sin(t/3*u))*2/3,r+=(160*Math.sin(t/12*u)+320*Math.sin(t*u/30))*2/3,r},Y=function(e,t){var t=+t,e=+e,r=300+e+2*t+.1*e*e+.1*e*t+.1*Math.sqrt(Math.abs(e));return r+=(20*Math.sin(6*e*u)+20*Math.sin(2*e*u))*2/3,r+=(20*Math.sin(e*u)+40*Math.sin(e/3*u))*2/3,r+=(150*Math.sin(e/12*u)+300*Math.sin(e/30*u))*2/3,r},W=function(e,t){var t=+t,e=+e;return!(e>73.66&&e<135.05&&t>3.86&&t<53.55)};const k=re.create({baseURL:"https://restapi.amap.com",timeout:3e3});k.interceptors.request.use(s=>(s.params.key||(s.params.key="ff7c1f3e9db95099f603f145142ae48d"),s),s=>Promise.reject(s));k.interceptors.response.use(({data:s})=>{if(s.status==="1")return s;w.error(`[${s.infocode}] ${s.info}`)},s=>Promise.reject(s));const de=s=>k.get("/v3/place/text",{params:{...s,citylimit:!0,offset:5}}),pe=(s,n,o)=>{const t=ce(s,n).join(",");return k.get("/v3/geocode/regeo",{params:{...o,location:t,extensions:"all"}})};function q(s){return s.map(n=>{const o=n.location.split(","),t=ue(o[0],o[1]);return{id:n.id,name:n.name,lon:t[0],lat:t[1],location:n.location,address:n.address}})}function he(s,n=!0){let o={type:"FeatureCollection",features:[]};for(let e=0;e<s.length;e++){const r=s[e],l={type:"Feature",properties:{no:e+1,...r},geometry:{type:"Point",coordinates:[r.lon,r.lat]}};o.features.push(l)}const t={sources:{poi:{type:"geojson",data:o,cluster:!0,clusterMaxZoom:14,clusterRadius:50}},layers:[{id:"clusters",type:"circle",source:"poi",filter:["has","point_count"],paint:{"circle-color":["step",["get","point_count"],"#51bbd6",100,"#f1f075",750,"#f28cb1"],"circle-radius":["step",["get","point_count"],20,100,30,750,40]}},{id:"cluster-count",type:"symbol",source:"poi",filter:["has","point_count"],layout:{"text-field":["get","point_count_abbreviated"],"text-size":12}},{id:"unclustered-point",type:"circle",source:"poi",filter:["!",["has","point_count"]],paint:{"circle-color":"#11b4da","circle-radius":5,"circle-stroke-width":2,"circle-stroke-color":"#fff"},metadata:{cursor:"pointer"}}]};if(n){const e=ne(o);t.bounds=e,t.fitBoundsOptions={padding:{top:100,right:100,bottom:100,left:100}}}return t}function me(s,n,o,t){const e=t==null?void 0:t.layerIds,r=l=>{s&&(e?s[l](n,e,o):s[l](n,o))};h.useEffect(()=>()=>{r("off")},[]),h.useEffect(()=>(r("on"),()=>{r("off")}),[s])}const{Title:fe,Text:b}=j,U=({data:s})=>i.jsxs($,{locale:H,children:[i.jsx(fe,{level:5,children:s.name}),i.jsxs("div",{children:[i.jsx(b,{strong:!0,children:"地址: "}),i.jsx(b,{copyable:!0,children:s.address})]}),i.jsxs("div",{children:[i.jsx(b,{strong:!0,children:"坐标: "}),i.jsx(b,{copyable:!0,children:`${s.lon},${s.lat}`})]})]}),ye=()=>{const{map:s}=J(),n=h.useRef(new L.Marker),o=h.useRef(new L.Popup({maxWidth:"400px"})),[t,e]=h.useState({count:0,pois:[]}),[r,l]=h.useState("1"),[c,m]=h.useState(""),[v,g]=h.useState(""),{loading:E,run:B}=_(de,{manual:!0,onSuccess(a){n.current.remove();const p=q(a.pois);e({count:+a.count,pois:p}),G(p)}}),{loading:Z,run:I}=_(pe,{manual:!0,onSuccess(a,p){const f=q(a.regeocode.pois);if(e({count:a.regeocode.pois.length,pois:f}),s){G(f,!1);const d=[p[0],p[1]],T=document.createElement("div");D(T).render(i.jsx(U,{data:{id:"1",name:d.join(","),location:d.join(","),lon:d[0],lat:d[1],address:a.regeocode.formatted_address}}));const O=new L.Popup;O.setDOMContent(T),n.current.setLngLat(d).setPopup(O).addTo(s),n.current.togglePopup(),s.flyTo({center:d,zoom:15})}}}),N=a=>{console.log("click"),I(+a.lngLat.lng.toFixed(6),+a.lngLat.lat.toFixed(6))};h.useEffect(()=>(g(""),s&&r==="3"&&s.on("click",N),()=>{s==null||s.off("click",N)}),[s,r]),me(s,"click",a=>{if(s&&a.features&&a.features[0].properties){const p=a.features[0].properties,f=[p.lon,p.lat];for(;Math.abs(a.lngLat.lng-f[0])>180;)f[0]+=a.lngLat.lng>f[0]?360:-360;const d=document.createElement("div");D(d).render(i.jsx(U,{data:p})),o.current.setDOMContent(d).setLngLat(f).addTo(s)}},{layerIds:["unclustered-point"]});const V=(a,p,f)=>{if(a)if(e({count:0,pois:[]}),r==="1")B({key:c,keywords:a,city:"023",page:1});else{const d=a.split(",");d.length===2?I(+d[0],+d[1]):w.error("请正确输入坐标, 如: 107.74,30.18")}else w.error("请输入关键字或坐标")},Q=a=>{r==="1"&&B({key:c,keywords:v,city:"023",page:a})},G=(a,p=!0)=>{if(s){s.removeGroupLayer("poi");const f=he(a,p);s.addGroupLayer("poi",f)}},X=a=>{s==null||s.flyTo({center:[a.lon,a.lat],zoom:12})};return i.jsx("div",{className:"w-[282px] p-[10px] border-r-[1px]",children:i.jsxs(z,{direction:"vertical",children:[i.jsxs(z,{direction:"vertical",children:[i.jsxs(C.Group,{defaultValue:"1",value:r,buttonStyle:"solid",onChange:a=>l(a.target.value),children:[i.jsx(C.Button,{value:"1",children:"地点搜索"}),i.jsx(C.Button,{value:"2",children:"坐标定位"}),i.jsx(C.Button,{value:"3",children:"地图选点"})]}),i.jsx(A.Password,{value:c,onChange:a=>m(a.target.value),placeholder:"请输入密钥（key）"}),r!=="3"&&i.jsx(A.Search,{enterButton:!0,value:v,placeholder:r==="1"?"请输入关键字":"请输入坐标, 如: 107.74,30.18",onChange:a=>g(a.target.value),onSearch:V})]}),i.jsx(F,{bordered:!0,size:"small",loading:E||Z,dataSource:t.pois,pagination:{size:"small",total:t.count,pageSize:5,hideOnSinglePage:!0,showSizeChanger:!1,showLessItems:!0,onChange:Q},renderItem:a=>i.jsx(F.Item,{children:i.jsxs("div",{className:"w-[225px] hover:cursor-pointer",onClick:()=>X(a),children:[i.jsx("p",{children:i.jsx(j.Text,{ellipsis:!0,strong:!0,children:a.name})}),i.jsx("p",{children:i.jsx(j.Text,{ellipsis:!0,type:"secondary",children:a.address})}),i.jsx("p",{children:i.jsx(j.Text,{ellipsis:!0,copyable:!0,children:`${a.lon},${a.lat}`})})]})})})]})})};function ve(){return i.jsx("div",{className:"w-screen h-screen",children:i.jsxs("div",{className:"flex flex-auto h-full",children:[i.jsx(ye,{}),i.jsx("div",{className:"flex-1",children:i.jsx(le,{})})]})})}ae.createRoot(document.getElementById("root")).render(i.jsx($,{locale:H,children:i.jsx(ie,{content:"naivemap.com",children:i.jsx(ve,{})})}));
