var _=Object.defineProperty;var A=(n,r,s)=>r in n?_(n,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[r]=s;var p=(n,r,s)=>(A(n,typeof r!="symbol"?r+"":r,s),s);import{c as z,r as m,m as b,a as D,b as k,j as a,d as F,e as U,u as q,S as E,R as C,I as w,L as B,T as j,f as H,C as J,g as K}from"./vendor-04e15888.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&t(l)}).observe(document,{childList:!0,subtree:!0});function s(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(e){if(e.ep)return;e.ep=!0;const o=s(e);fetch(e.href,o)}})();const G=z()((n,r)=>({map:void 0,setMap:s=>n({map:s}),removeMap:()=>{n({map:void 0})},addGroupLayer(s,t){const e=r().map;e&&e.addGroupLayer(s,t)},removeGroupLayer(s,t){const e=r().map;e&&e.removeGroupLayer(s,t)},removeGroupLayers(){const s=r().map;s&&s.removeGroupLayers()},getSource(s){const t=r().map;if(t)return t.getSource(s)},addSource(s,t){const e=r().map;e&&e.addSource(s,t)},removeSource(s){const t=r().map;t&&t.removeSource(s)},getLayer(s){const t=r().map;if(t)return t.getLayer(s)},addLayer(s,t){const e=r().map;e&&e.addLayer(s,t)},removeLayer(s){const t=r().map;t&&t.removeLayer(s)},setBasemapStyle(s,t,e){const o=r().map;o&&o.setBasemapStyle(s,t,e)},clear:s=>{const t=r().map;if(t&&t.getStyle())if(Array.isArray(s))for(let e=0,o=s.length;e<o;e++){const l=s[e];t.removeGroupLayer(l),t.getLayer(l)&&t.removeLayer(l),t.getSource(l)&&t.removeSource(l)}else{if(s.groupLayerIds)for(let e=0,o=s.groupLayerIds.length;e<o;e++)t.removeGroupLayer(s.groupLayerIds[e]);if(s.layerIds)for(let e=0,o=s.layerIds.length;e<o;e++)t.removeLayer(s.layerIds[e]);if(s.sourceIds)for(let e=0,o=s.sourceIds.length;e<o;e++)t.removeSource(s.sourceIds[e])}}})),v=class v{constructor(r,s){p(this,"controlContainer");p(this,"events");p(this,"map");p(this,"mapStyleContainer");p(this,"styleButton");p(this,"styles");p(this,"defaultStyle");this.styles=r||v.DEFAULT_STYLES;const t=typeof s=="string"?s:s?s.defaultStyle:void 0;this.defaultStyle=t||v.DEFAULT_STYLE,this.onDocumentClick=this.onDocumentClick.bind(this),this.events=typeof s!="string"&&s?s.eventListeners:void 0}getDefaultPosition(){return"top-right"}onAdd(r){this.map=r,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("mapboxgl-ctrl"),this.controlContainer.classList.add("mapboxgl-ctrl-group"),this.mapStyleContainer=document.createElement("div"),this.styleButton=document.createElement("button"),this.styleButton.type="button",this.mapStyleContainer.classList.add("mapboxgl-style-list");for(const s of this.styles){const t=document.createElement("button");t.type="button",t.innerText=s.title,t.classList.add(s.title.replace(/[^a-z0-9-]/gi,"_")),t.dataset.uri=JSON.stringify(s.uri),t.addEventListener("click",e=>{const o=e.srcElement;if(this.closeModal(),o.classList.contains("active")||this.events&&this.events.onOpen&&this.events.onOpen(e))return;const l=JSON.parse(o.dataset.uri);this.map.setBasemapStyle(l);const c=this.mapStyleContainer.getElementsByClassName("active");for(;c[0];)c[0].classList.remove("active");o.classList.add("active"),this.events&&this.events.onChange&&this.events.onChange(e,l)}),s.title===this.defaultStyle&&t.classList.add("active"),this.mapStyleContainer.appendChild(t)}return this.styleButton.classList.add("mapboxgl-ctrl-icon"),this.styleButton.classList.add("mapboxgl-style-switcher"),this.styleButton.addEventListener("click",s=>{this.events&&this.events.onSelect&&this.events.onSelect(s)||this.openModal()}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.styleButton),this.controlContainer.appendChild(this.mapStyleContainer),this.controlContainer}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.styleButton||(this.styleButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.map=void 0)}closeModal(){this.mapStyleContainer&&this.styleButton&&(this.mapStyleContainer.style.display="none",this.styleButton.style.display="block")}openModal(){this.mapStyleContainer&&this.styleButton&&(this.mapStyleContainer.style.display="block",this.styleButton.style.display="none")}onDocumentClick(r){this.controlContainer&&!this.controlContainer.contains(r.target)&&this.closeModal()}};p(v,"DEFAULT_STYLE","标准"),p(v,"DEFAULT_STYLES",[{title:"标准",uri:"mapbox://styles/huanglii/clm8knsuz012801r41pbwdcku"},{title:"浅色",uri:"mapbox://styles/huanglii/clm93m2qr011a01r671y2hjjm"},{title:"深色",uri:"mapbox://styles/huanglii/clm8quldc013701nza7a35j7j"},{title:"影像1",uri:"./style/satellite.json"},{title:"影像2",uri:"mapbox://styles/huanglii/cl0j3k0wn000n14nznby52wod"}]);let M=v;const Y=n=>{const{setMap:r,removeMap:s}=G(),t=m.useRef(null),[e]=m.useState(Math.random().toString(16).substring(2));b.accessToken="pk.eyJ1IjoiaHVhbmdsaWkiLCJhIjoiY2wwM2E4a2drMDVrZjNrcGRucHIxOHo0cyJ9.0ecG5KGQE6R-SmhxvLvhHg";const l=Object.assign({},{style:"mapbox://styles/huanglii/clm8knsuz012801r41pbwdcku",container:e,bounds:[105.289838,28.164713,110.195632,32.204171],fitBoundsOptions:{padding:{top:20,right:20,bottom:20,left:20}},attributionControl:!1,locale:{"NavigationControl.ResetBearing":"指北","NavigationControl.ZoomIn":"放大","NavigationControl.ZoomOut":"缩小","GeolocateControl.FindMyLocation":"定位","GeolocateControl.LocationNotAvailable":"定位不可用"}},n.mapboxOptions);return m.useEffect(()=>{const c=new D(l);return c.addControl(new k.NavigationControl({visualizePitch:!0})),c.addControl(new k.GeolocateControl({trackUserLocation:!0,showUserHeading:!0})),c.addControl(new b.AttributionControl({customAttribution:`v${b.version}`})),c.addControl(new M),c.on("load",()=>{r(c),n.onMapLoaded&&n.onMapLoaded(c)}),c.on("remove",()=>{s()}),()=>c.remove()},[]),a.jsx("div",{id:e,className:n.className,style:{width:"100%",height:"100%"},ref:t})},O=F.create({baseURL:"https://restapi.amap.com",timeout:3e3});O.interceptors.response.use(({data:n})=>{if(n.status==="1")return n;U.error(`[${n.infocode}] ${n.info}`)},n=>Promise.reject(n));const $=n=>(n.key||(n.key="ff7c1f3e9db95099f603f145142ae48d"),O.get("/v3/place/text",{params:{...n,citylimit:!0,offset:5}}));var u=3.141592653589793,I=6378245,N=.006693421622965943,V=function(e,t){var t=+t,e=+e;if(W(e,t))return[e,t];var o=Z(e-105,t-35),l=Q(e-105,t-35),c=t/180*u,h=Math.sin(c);h=1-N*h*h;var g=Math.sqrt(h);o=o*180/(I*(1-N)/(h*g)*u),l=l*180/(I/g*Math.cos(c)*u);var L=t+o,S=e+l;return[e*2-S,t*2-L]},Z=function(e,t){var t=+t,e=+e,o=-100+2*e+3*t+.2*t*t+.1*e*t+.2*Math.sqrt(Math.abs(e));return o+=(20*Math.sin(6*e*u)+20*Math.sin(2*e*u))*2/3,o+=(20*Math.sin(t*u)+40*Math.sin(t/3*u))*2/3,o+=(160*Math.sin(t/12*u)+320*Math.sin(t*u/30))*2/3,o},Q=function(e,t){var t=+t,e=+e,o=300+e+2*t+.1*e*e+.1*e*t+.1*Math.sqrt(Math.abs(e));return o+=(20*Math.sin(6*e*u)+20*Math.sin(2*e*u))*2/3,o+=(20*Math.sin(e*u)+40*Math.sin(e/3*u))*2/3,o+=(150*Math.sin(e/12*u)+300*Math.sin(e/30*u))*2/3,o},W=function(e,t){var t=+t,e=+e;return!(e>73.66&&e<135.05&&t>3.86&&t<53.55)};const X=()=>{const{map:n}=G(),[r,s]=m.useState({count:0,pois:[]}),[t,e]=m.useState("1"),[o,l]=m.useState(""),[c,h]=m.useState("重庆"),{loading:g,run:L}=q($,{manual:!0,onSuccess(i){const y=i.pois.map(d=>{const f=d.location.split(","),x=V(f[0],f[1]);return{id:d.id,name:d.name,lon:x[0],lat:x[1],location:d.location,address:d.address}});s({count:+i.count,pois:y}),T(y)}}),S=(i,y,d)=>{L({key:o,keywords:i,city:"023",page:1})},P=i=>{L({key:o,keywords:c,city:"023",page:i})},T=i=>{if(n){n.removeGroupLayer("poi");let y={type:"FeatureCollection",features:[]};for(let d=0;d<i.length;d++){const f=i[d],x={type:"Feature",properties:{no:d+1,...f},geometry:{type:"Point",coordinates:[f.lon,f.lat]}};y.features.push(x)}n.addGroupLayer("poi",{sources:{poi:{type:"geojson",data:y,cluster:!0,clusterMaxZoom:14,clusterRadius:50}},layers:[{id:"clusters",type:"circle",source:"poi",filter:["has","point_count"],paint:{"circle-color":["step",["get","point_count"],"#51bbd6",100,"#f1f075",750,"#f28cb1"],"circle-radius":["step",["get","point_count"],20,100,30,750,40]}},{id:"cluster-count",type:"symbol",source:"poi",filter:["has","point_count"],layout:{"text-field":["get","point_count_abbreviated"],"text-size":12}},{id:"unclustered-point",type:"circle",source:"poi",filter:["!",["has","point_count"]],paint:{"circle-color":"#11b4da","circle-radius":5,"circle-stroke-width":2,"circle-stroke-color":"#fff"},metadata:{cursor:"pointer"}}]})}},R=i=>{console.log(i),n==null||n.flyTo({center:[i.lon,i.lat],zoom:12})};return a.jsx("div",{className:"w-[282px] p-[10px]",children:a.jsxs(E,{direction:"vertical",children:[a.jsxs(E,{direction:"vertical",children:[a.jsxs(C.Group,{defaultValue:"1",value:t,buttonStyle:"solid",onChange:i=>e(i.target.value),children:[a.jsx(C.Button,{value:"1",children:"地点搜索"}),a.jsx(C.Button,{value:"2",children:"坐标定位"}),a.jsx(C.Button,{value:"3",children:"地图选点"})]}),a.jsx(w.Password,{value:o,onChange:i=>l(i.target.value),placeholder:"请输入密钥（key）"}),t!=="3"&&a.jsx(w.Search,{enterButton:!0,defaultValue:"气象局",value:c,placeholder:t==="1"?"请输入关键字":"请输入坐标, 如: 107.74,30.18",onChange:i=>h(i.target.value),onSearch:S})]}),a.jsx(B,{bordered:!0,size:"small",loading:g,dataSource:r.pois,pagination:{size:"small",total:r.count,pageSize:5,hideOnSinglePage:!0,showSizeChanger:!1,showLessItems:!0,onChange:P},renderItem:i=>a.jsx(B.Item,{children:a.jsxs("div",{className:"w-[225px] hover:cursor-pointer",onClick:()=>R(i),children:[a.jsx("p",{children:a.jsx(j.Text,{ellipsis:!0,strong:!0,children:i.name})}),a.jsx("p",{children:a.jsx(j.Text,{ellipsis:!0,type:"secondary",children:i.address})}),a.jsx("p",{children:a.jsx(j.Text,{ellipsis:!0,copyable:!0,children:`${i.lon.toFixed(6)},${i.lat.toFixed(6)}`})})]})})})]})})};function ee(){return a.jsx("div",{className:"w-screen h-screen",children:a.jsxs("div",{className:"flex flex-auto h-full",children:[a.jsx(X,{}),a.jsx("div",{className:"flex-1",children:a.jsx(Y,{})})]})})}H.createRoot(document.getElementById("root")).render(a.jsx(J,{locale:K,children:a.jsx(ee,{})}));
